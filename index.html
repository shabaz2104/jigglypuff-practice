<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Web System ‚Äî Intelligent Pharmacy Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #2E86DE;
    --navy: #1B3A57;
    --bg: #F7F9FC;
    --white: #ffffff;
    --teal: #3AAFB9;
    --green-ok: #27AE60;
    --orange-low: #E67E22;
    --red-critical: #E74C3C;
    --text: #1a2332;
    --text-muted: #6b7c93;
    --border: #e1e8f0;
    --card-shadow: 0 2px 12px rgba(46,134,222,0.08);
    --card-hover: 0 8px 32px rgba(46,134,222,0.18);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Sora',sans-serif; background:var(--bg); color:var(--text); overflow-x:hidden; }

  /* PAGES */
  .page { display:none; min-height:100vh; }
  .page.active { display:block; }

  /* ===== NAVBAR ===== */
  nav {
    position:fixed; top:0; left:0; right:0; z-index:1000;
    background:rgba(255,255,255,0.95); backdrop-filter:blur(16px);
    border-bottom:1px solid var(--border);
    padding:0 2rem; height:64px;
    display:flex; align-items:center; justify-content:space-between;
    box-shadow:0 2px 20px rgba(46,134,222,0.08);
  }
  .nav-logo {
    display:flex; align-items:center; gap:10px; cursor:pointer;
    font-weight:800; font-size:1.1rem; color:var(--navy); letter-spacing:-0.5px;
  }
  .nav-logo .dot { width:10px;height:10px;background:var(--primary);border-radius:50%;animation:pulse-dot 2s infinite; }
  @keyframes pulse-dot { 0%,100%{transform:scale(1);opacity:1} 50%{transform:scale(1.4);opacity:.7} }
  .nav-links { display:flex; align-items:center; gap:0.25rem; }
  .nav-link {
    padding:6px 14px; border-radius:8px; cursor:pointer; font-size:0.88rem; font-weight:500;
    color:var(--text-muted); transition:all 0.2s; border:none; background:none;
  }
  .nav-link:hover, .nav-link.active { background:var(--primary); color:#fff; }
  .nav-right { display:flex; align-items:center; gap:10px; }
  .cart-btn {
    position:relative; background:var(--bg); border:1px solid var(--border);
    border-radius:10px; padding:8px 14px; cursor:pointer; font-size:0.85rem;
    color:var(--text); transition:all 0.2s; display:flex; align-items:center; gap:6px;
  }
  .cart-btn:hover { border-color:var(--primary); color:var(--primary); }
  .cart-count {
    position:absolute; top:-6px; right:-6px;
    background:var(--red-critical); color:#fff; font-size:0.65rem;
    width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;
    font-weight:700;
  }
  .btn-login {
    background:var(--primary); color:#fff; border:none; border-radius:10px;
    padding:8px 20px; font-size:0.85rem; font-weight:600; cursor:pointer; transition:all 0.2s;
    font-family:'Sora',sans-serif;
  }
  .btn-login:hover { background:var(--navy); transform:translateY(-1px); }

  /* ===== STARTUP / HERO ===== */
  #page-home {
    background: linear-gradient(135deg, #f0f6ff 0%, #e8f4fd 50%, #f0f8ff 100%);
    position:relative; overflow:hidden;
  }
  .hero-particles { position:absolute; inset:0; pointer-events:none; }
  .particle {
    position:absolute; border-radius:50%; opacity:0.15;
    animation:float-particle linear infinite;
  }
  @keyframes float-particle {
    0%{transform:translateY(100vh) rotate(0deg); opacity:0}
    10%{opacity:.15}
    90%{opacity:.15}
    100%{transform:translateY(-100px) rotate(720deg); opacity:0}
  }
  .hero-content {
    position:relative; z-index:2; min-height:100vh; display:flex;
    flex-direction:column; align-items:center; justify-content:center;
    text-align:center; padding:100px 2rem 4rem;
  }
  .hero-badge {
    display:inline-flex; align-items:center; gap:8px;
    background:rgba(46,134,222,0.1); border:1px solid rgba(46,134,222,0.2);
    color:var(--primary); border-radius:100px; padding:6px 18px; font-size:0.8rem; font-weight:600;
    margin-bottom:2rem; animation:slide-down 0.8s ease both;
  }
  @keyframes slide-down { from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:translateY(0)} }
  .hero-title {
    font-size:clamp(2.5rem,6vw,4.5rem); font-weight:800; line-height:1.1;
    color:var(--navy); margin-bottom:1.5rem; letter-spacing:-1.5px;
    animation:slide-up 0.9s ease 0.1s both;
  }
  .hero-title span { color:var(--primary); position:relative; }
  .hero-title span::after {
    content:''; position:absolute; bottom:-4px; left:0; right:0; height:3px;
    background:var(--primary); border-radius:2px;
    animation:expand-line 1s ease 1s both;
  }
  @keyframes expand-line { from{transform:scaleX(0)} to{transform:scaleX(1)} }
  @keyframes slide-up { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
  .hero-sub {
    font-size:1.15rem; color:var(--text-muted); max-width:600px; line-height:1.7;
    margin-bottom:2.5rem; animation:slide-up 0.9s ease 0.2s both; font-weight:400;
  }
  .hero-ctas { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-bottom:2rem; animation:slide-up 0.9s ease 0.3s both; }
  .btn-primary {
    background:var(--primary); color:#fff; border:none; border-radius:12px;
    padding:14px 32px; font-size:1rem; font-weight:700; cursor:pointer; transition:all 0.25s;
    font-family:'Sora',sans-serif; box-shadow:0 4px 20px rgba(46,134,222,0.35);
  }
  .btn-primary:hover { background:var(--navy); transform:translateY(-2px); box-shadow:0 8px 28px rgba(46,134,222,0.4); }
  .btn-secondary {
    background:#fff; color:var(--primary); border:2px solid var(--primary); border-radius:12px;
    padding:14px 32px; font-size:1rem; font-weight:700; cursor:pointer; transition:all 0.25s;
    font-family:'Sora',sans-serif;
  }
  .btn-secondary:hover { background:var(--primary); color:#fff; transform:translateY(-2px); }
  .hero-search-wrap {
    width:100%; max-width:560px; margin-bottom:3rem;
    animation:slide-up 0.9s ease 0.35s both; position:relative;
  }
  .hero-search {
    width:100%; padding:16px 56px 16px 20px; border:2px solid var(--border);
    border-radius:16px; font-size:1rem; font-family:'Sora',sans-serif;
    background:#fff; box-shadow:0 4px 20px rgba(46,134,222,0.1); outline:none;
    transition:all 0.2s;
  }
  .hero-search:focus { border-color:var(--primary); box-shadow:0 4px 24px rgba(46,134,222,0.2); }
  .search-icon { position:absolute; right:18px; top:50%; transform:translateY(-50%); font-size:1.2rem; color:var(--primary); }
  .hero-badges {
    display:flex; gap:16px; flex-wrap:wrap; justify-content:center;
    animation:slide-up 0.9s ease 0.4s both;
  }
  .h-badge {
    display:flex; align-items:center; gap:8px; background:#fff; border:1px solid var(--border);
    border-radius:10px; padding:10px 18px; font-size:0.82rem; font-weight:600; color:var(--navy);
    box-shadow:0 2px 10px rgba(0,0,0,0.06);
  }
  .h-badge .icon { color:var(--green-ok); }

  /* Floating stats */
  .hero-stats {
    display:grid; grid-template-columns:repeat(3,1fr); gap:20px;
    max-width:700px; margin:3rem auto 0;
    animation:slide-up 0.9s ease 0.5s both;
  }
  .stat-card {
    background:#fff; border:1px solid var(--border); border-radius:16px;
    padding:20px; text-align:center; box-shadow:var(--card-shadow);
  }
  .stat-num { font-size:2rem; font-weight:800; color:var(--primary); }
  .stat-label { font-size:0.8rem; color:var(--text-muted); margin-top:4px; }

  /* Scroll indicator */
  .scroll-ind { animation:bounce 2s infinite; margin-top:2rem; color:var(--text-muted); font-size:1.5rem; }
  @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(8px)} }

  /* ===== SECTION WRAPPER ===== */
  .section { padding:5rem 2rem; max-width:1200px; margin:0 auto; }
  .section-title { font-size:2rem; font-weight:800; color:var(--navy); margin-bottom:0.5rem; }
  .section-sub { color:var(--text-muted); margin-bottom:2.5rem; font-size:1rem; }

  /* ===== PRODUCTS GRID ===== */
  .products-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:20px; }
  .product-card {
    background:#fff; border:1px solid var(--border); border-radius:16px; padding:20px;
    box-shadow:var(--card-shadow); transition:all 0.25s; cursor:pointer;
  }
  .product-card:hover { box-shadow:var(--card-hover); transform:translateY(-3px); border-color:var(--primary); }
  .product-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
  .product-name { font-weight:700; font-size:0.9rem; color:var(--navy); line-height:1.4; flex:1; }
  .rx-badge {
    background:#fff3cd; color:#856404; border:1px solid #ffc107;
    font-size:0.65rem; font-weight:700; padding:2px 8px; border-radius:6px; white-space:nowrap; margin-left:8px;
  }
  .product-desc { font-size:0.78rem; color:var(--text-muted); line-height:1.5; margin-bottom:12px; }
  .product-bottom { display:flex; align-items:center; justify-content:space-between; }
  .product-price { font-size:1.3rem; font-weight:800; color:var(--primary); }
  .product-size { font-size:0.75rem; color:var(--text-muted); }
  .ai-tag { font-size:0.65rem; color:var(--teal); font-weight:600; }
  .add-cart-btn {
    background:var(--primary); color:#fff; border:none; border-radius:8px;
    padding:7px 14px; font-size:0.8rem; font-weight:600; cursor:pointer;
    transition:all 0.2s; font-family:'Sora',sans-serif;
  }
  .add-cart-btn:hover { background:var(--navy); }
  .stock-badge {
    font-size:0.7rem; font-weight:600; padding:2px 8px; border-radius:6px;
  }
  .stock-in { background:#d4edda; color:var(--green-ok); }
  .stock-low { background:#fff3cd; color:var(--orange-low); }

  /* ===== AI AGENT SECTION ===== */
  #page-ai { background:var(--bg); padding-top:64px; }
  .ai-layout { display:grid; grid-template-columns:1fr 1fr; gap:24px; padding:2rem; max-width:1300px; margin:0 auto; }
  
  /* Notification bar */
  .notif-bar {
    background:var(--navy); color:#fff; padding:10px 2rem;
    display:flex; align-items:center; gap:12px; font-size:0.82rem; overflow:hidden;
    position:relative;
  }
  .notif-bar .badge { background:var(--primary); padding:2px 10px; border-radius:6px; font-weight:700; font-size:0.75rem; white-space:nowrap; }
  .notif-scroll { display:flex; gap:24px; animation:scroll-notif 20s linear infinite; white-space:nowrap; }
  @keyframes scroll-notif { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

  /* Order Meds button */
  .order-meds-bar {
    display:flex; align-items:center; justify-content:flex-end; padding:8px 2rem;
    gap:10px; background:#fff; border-bottom:1px solid var(--border);
  }
  .order-meds-btn {
    background:var(--green-ok); color:#fff; border:none; border-radius:8px;
    padding:6px 16px; font-size:0.82rem; font-weight:600; cursor:pointer;
    font-family:'Sora',sans-serif; transition:all 0.2s;
  }
  .order-meds-btn:hover { background:#219d53; }

  /* Chat Panel */
  .chat-panel {
    background:#fff; border-radius:20px; border:1px solid var(--border);
    box-shadow:var(--card-shadow); display:flex; flex-direction:column; height:600px;
    overflow:hidden;
  }
  .chat-header {
    background:var(--navy); color:#fff; padding:18px 20px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .chat-header-left { display:flex; align-items:center; gap:12px; }
  .ai-avatar {
    width:42px;height:42px;background:var(--primary);border-radius:12px;
    display:flex;align-items:center;justify-content:center;font-size:1.3rem;
  }
  .chat-title { font-weight:700; font-size:1rem; }
  .chat-sub { font-size:0.75rem; opacity:0.7; }
  .status-row { display:flex; align-items:center; gap:12px; }
  .status-dot { width:8px;height:8px;background:#2ecc71;border-radius:50%;animation:pulse-dot 2s infinite; }
  .status-text { font-size:0.75rem; opacity:0.85; }
  .compliance-badge { background:rgba(46,134,222,0.3); padding:3px 10px; border-radius:6px; font-size:0.72rem; font-weight:600; }
  
  .chat-messages { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:14px; }
  .msg { display:flex; gap:10px; max-width:85%; }
  .msg.user { flex-direction:row-reverse; align-self:flex-end; }
  .msg-bubble {
    padding:12px 16px; border-radius:16px; font-size:0.88rem; line-height:1.5;
  }
  .msg.ai .msg-bubble { background:#f0f6ff; color:var(--text); border-radius:4px 16px 16px 16px; }
  .msg.user .msg-bubble { background:var(--primary); color:#fff; border-radius:16px 4px 16px 16px; }
  .msg-avatar { width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0; }
  .msg.ai .msg-avatar { background:var(--navy); }
  .msg.user .msg-avatar { background:var(--teal); }
  .system-event {
    background:#f8fafc; border:1px solid var(--border); border-radius:10px;
    padding:8px 14px; font-size:0.78rem; color:var(--text-muted); text-align:center;
    display:flex; align-items:center; gap:8px; justify-content:center;
  }
  .intent-tag { font-size:0.7rem; background:#e8f4fd; color:var(--primary); padding:2px 8px; border-radius:4px; font-weight:600; margin-top:6px; }
  
  .chat-footer { padding:14px; border-top:1px solid var(--border); display:flex; gap:10px; align-items:center; }
  .voice-btn {
    width:42px;height:42px;background:var(--primary);border:none;border-radius:50%;
    font-size:1.1rem;cursor:pointer;flex-shrink:0;transition:all 0.2s;color:#fff;
    display:flex;align-items:center;justify-content:center;
  }
  .voice-btn:hover { background:var(--navy); transform:scale(1.1); }
  .voice-btn.active { background:var(--red-critical); animation:pulse-red 1s infinite; }
  @keyframes pulse-red { 0%,100%{box-shadow:0 0 0 0 rgba(231,76,60,0.4)} 50%{box-shadow:0 0 0 8px rgba(231,76,60,0)} }
  .chat-input {
    flex:1; padding:12px 16px; border:1px solid var(--border); border-radius:12px;
    font-family:'Sora',sans-serif; font-size:0.88rem; outline:none; transition:all 0.2s;
  }
  .chat-input:focus { border-color:var(--primary); }
  .send-btn {
    background:var(--primary); color:#fff; border:none; border-radius:12px;
    padding:10px 20px; font-weight:700; font-size:0.88rem; cursor:pointer;
    font-family:'Sora',sans-serif; transition:all 0.2s;
  }
  .send-btn:hover { background:var(--navy); }
  
  /* Voice call btn */
  .vcall-btn {
    background:var(--green-ok); color:#fff; border:none; border-radius:10px;
    padding:8px 16px; font-size:0.82rem; font-weight:600; cursor:pointer;
    font-family:'Sora',sans-serif; transition:all 0.2s; display:flex; align-items:center; gap:6px;
  }
  .vcall-btn:hover { background:#219d53; }

  /* Admin Mini Dashboard */
  .admin-mini { background:#fff; border-radius:20px; border:1px solid var(--border); box-shadow:var(--card-shadow); padding:24px; }
  .mini-title { font-size:1.1rem; font-weight:800; color:var(--navy); margin-bottom:16px; }
  .mini-stats { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px; }
  .mini-stat { background:var(--bg); border-radius:12px; padding:14px; }
  .mini-stat-num { font-size:1.5rem; font-weight:800; color:var(--primary); }
  .mini-stat-label { font-size:0.75rem; color:var(--text-muted); margin-top:2px; }
  
  .stock-table { width:100%; border-collapse:collapse; font-size:0.83rem; }
  .stock-table th { text-align:left; color:var(--text-muted); font-weight:600; padding:8px 0; border-bottom:1px solid var(--border); }
  .stock-table td { padding:10px 0; border-bottom:1px solid #f0f4f8; }
  .status-badge { font-size:0.72rem; font-weight:700; padding:3px 10px; border-radius:6px; }
  .s-green { background:#d4edda; color:var(--green-ok); }
  .s-orange { background:#fff3cd; color:var(--orange-low); }
  .s-red { background:#f8d7da; color:var(--red-critical); }

  /* AI Insights Widget */
  .ai-insights { margin-top:16px; background:#f0f6ff; border:1px solid rgba(46,134,222,0.15); border-radius:12px; padding:16px; }
  .ai-insights-title { font-size:0.85rem; font-weight:700; color:var(--primary); margin-bottom:10px; display:flex; align-items:center; gap:6px; }
  .insight-row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid rgba(46,134,222,0.1); font-size:0.8rem; }
  .insight-val { font-weight:700; color:var(--navy); }

  /* ===== ADMIN PANEL ===== */
  #page-admin { padding-top:64px; }
  .admin-layout { display:flex; min-height:calc(100vh - 64px); }
  .admin-sidebar {
    width:240px; background:var(--navy); color:#fff; flex-shrink:0;
    padding:24px 0; display:flex; flex-direction:column;
  }
  .sidebar-logo { padding:0 20px 24px; font-weight:800; font-size:1.05rem; border-bottom:1px solid rgba(255,255,255,0.1); }
  .sidebar-nav { flex:1; padding:16px 0; }
  .sidebar-link {
    display:flex; align-items:center; gap:12px; padding:12px 20px;
    cursor:pointer; font-size:0.88rem; transition:all 0.2s; color:rgba(255,255,255,0.7);
    border-left:3px solid transparent;
  }
  .sidebar-link:hover, .sidebar-link.active { color:#fff; background:rgba(255,255,255,0.08); border-left-color:var(--primary); }
  .admin-main { flex:1; padding:28px; background:var(--bg); overflow-y:auto; }
  .admin-panel { display:none; }
  .admin-panel.active { display:block; }

  /* Overview Cards */
  .ov-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:28px; }
  .ov-card {
    background:#fff; border:1px solid var(--border); border-radius:16px; padding:22px;
    box-shadow:var(--card-shadow);
  }
  .ov-card-label { font-size:0.8rem; color:var(--text-muted); font-weight:600; margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px; }
  .ov-card-val { font-size:1.8rem; font-weight:800; color:var(--navy); }
  .ov-card-change { font-size:0.78rem; margin-top:6px; font-weight:600; }
  .up { color:var(--green-ok); }
  .down { color:var(--red-critical); }

  /* Charts area */
  .charts-row { display:grid; grid-template-columns:2fr 1fr; gap:20px; margin-bottom:28px; }
  .chart-card { background:#fff; border:1px solid var(--border); border-radius:16px; padding:22px; box-shadow:var(--card-shadow); }
  .chart-title { font-size:1rem; font-weight:700; color:var(--navy); margin-bottom:16px; display:flex; justify-content:space-between; align-items:center; }
  
  /* Simple bar chart */
  .bar-chart { display:flex; align-items:flex-end; gap:6px; height:120px; }
  .bar {
    flex:1; background:linear-gradient(180deg,var(--primary),#74b9ff);
    border-radius:6px 6px 0 0; position:relative; min-width:0;
    transition:opacity 0.2s; cursor:pointer;
  }
  .bar:hover { opacity:0.8; }
  .bar-label { text-align:center; font-size:0.65rem; color:var(--text-muted); margin-top:4px; }

  /* Data Table */
  .data-card { background:#fff; border:1px solid var(--border); border-radius:16px; padding:22px; box-shadow:var(--card-shadow); margin-bottom:20px; }
  .data-card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
  .data-table { width:100%; border-collapse:collapse; font-size:0.84rem; }
  .data-table th { text-align:left; padding:10px 12px; font-size:0.78rem; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.5px; border-bottom:2px solid var(--border); background:#fafbfd; }
  .data-table td { padding:12px 12px; border-bottom:1px solid #f0f4f8; vertical-align:middle; }
  .data-table tr:hover td { background:#f8fafc; }
  
  /* Search + actions bar */
  .search-bar-wrap { display:flex; gap:10px; margin-bottom:20px; }
  .admin-search {
    flex:1; padding:10px 16px; border:1px solid var(--border); border-radius:10px;
    font-family:'Sora',sans-serif; font-size:0.88rem; outline:none; background:#fff;
  }
  .admin-search:focus { border-color:var(--primary); }
  .filter-btn { background:#fff; border:1px solid var(--border); border-radius:10px; padding:10px 16px; cursor:pointer; font-size:0.85rem; transition:all 0.2s; }
  .filter-btn:hover { border-color:var(--primary); color:var(--primary); }

  /* Stock panel */
  .stock-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
  .stock-card { background:#fff; border:1px solid var(--border); border-radius:16px; padding:20px; box-shadow:var(--card-shadow); }
  .stock-card-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:16px; }
  .stock-name { font-weight:700; font-size:0.9rem; color:var(--navy); }
  .stock-qty { font-size:2rem; font-weight:800; color:var(--primary); }
  .stock-unit { font-size:0.75rem; color:var(--text-muted); }
  .stock-controls { display:flex; align-items:center; gap:8px; margin-top:12px; }
  .qty-btn {
    width:32px;height:32px;border-radius:8px;border:1px solid var(--border);background:#fff;
    font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;
    font-weight:700; transition:all 0.2s;
  }
  .qty-btn:hover { background:var(--primary); color:#fff; border-color:var(--primary); }
  .qty-display { font-size:1.1rem; font-weight:800; color:var(--navy); min-width:36px; text-align:center; }

  /* ===== ABOUT PAGE ===== */
  #page-about { padding-top:64px; background:var(--bg); }
  .about-hero { background:var(--navy); color:#fff; padding:5rem 2rem; text-align:center; }
  .about-hero h1 { font-size:3rem; font-weight:800; margin-bottom:1rem; }
  .about-hero p { font-size:1.15rem; opacity:0.8; max-width:700px; margin:0 auto; line-height:1.8; }
  .about-body { max-width:900px; margin:0 auto; padding:4rem 2rem; }
  .about-section { margin-bottom:3rem; }
  .about-section h2 { font-size:1.6rem; font-weight:800; color:var(--navy); margin-bottom:1rem; }
  .about-section p { color:var(--text-muted); line-height:1.9; font-size:0.95rem; margin-bottom:1rem; }

  /* ===== SAFETY PAGE ===== */
  #page-safety { padding-top:64px; background:var(--bg); }
  .safety-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px; }
  .safety-card { background:#fff; border:1px solid var(--border); border-radius:16px; padding:28px; box-shadow:var(--card-shadow); }
  .safety-icon { font-size:2.5rem; margin-bottom:16px; }
  .safety-card h3 { font-size:1.1rem; font-weight:700; color:var(--navy); margin-bottom:8px; }
  .safety-card p { font-size:0.88rem; color:var(--text-muted); line-height:1.7; }

  /* ===== CART MODAL ===== */
  .modal-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:2000;
    display:none; align-items:center; justify-content:center;
  }
  .modal-overlay.open { display:flex; }
  .modal {
    background:#fff; border-radius:20px; padding:32px; max-width:560px; width:90%;
    max-height:80vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.2);
    animation:modal-in 0.3s ease;
  }
  @keyframes modal-in { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:scale(1)} }
  .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
  .modal-title { font-size:1.3rem; font-weight:800; color:var(--navy); }
  .modal-close { background:none; border:none; font-size:1.5rem; cursor:pointer; color:var(--text-muted); }
  .cart-item { display:flex; justify-content:space-between; align-items:center; padding:14px 0; border-bottom:1px solid var(--border); }
  .cart-item-name { font-size:0.9rem; font-weight:600; color:var(--text); flex:1; }
  .cart-item-price { font-weight:700; color:var(--primary); margin:0 12px; }
  .remove-btn { background:none; border:none; cursor:pointer; color:var(--red-critical); font-size:1rem; }
  .cart-total { display:flex; justify-content:space-between; padding:16px 0; font-size:1.1rem; font-weight:800; color:var(--navy); }
  .checkout-btn {
    width:100%; background:var(--primary); color:#fff; border:none; border-radius:12px;
    padding:14px; font-size:1rem; font-weight:700; cursor:pointer; font-family:'Sora',sans-serif;
    transition:all 0.2s; margin-top:8px;
  }
  .checkout-btn:hover { background:var(--navy); }

  /* Login Modal */
  .login-form { display:flex; flex-direction:column; gap:14px; }
  .form-group { display:flex; flex-direction:column; gap:6px; }
  .form-label { font-size:0.85rem; font-weight:600; color:var(--text); }
  .form-input {
    padding:11px 14px; border:1px solid var(--border); border-radius:10px;
    font-family:'Sora',sans-serif; font-size:0.9rem; outline:none; transition:all 0.2s;
  }
  .form-input:focus { border-color:var(--primary); }

  /* Toast */
  .toast {
    position:fixed; bottom:24px; right:24px; background:var(--navy); color:#fff;
    padding:12px 20px; border-radius:12px; font-size:0.88rem; font-weight:600;
    z-index:3000; transform:translateY(100px); opacity:0;
    transition:all 0.3s; box-shadow:0 8px 30px rgba(0,0,0,0.3);
  }
  .toast.show { transform:translateY(0); opacity:1; }

  /* AI Compliance Indicator */
  .compliance-strip {
    background:linear-gradient(90deg,#1B3A57,#2E86DE);
    color:#fff; padding:8px 2rem; font-size:0.78rem;
    display:flex; gap:20px; align-items:center; flex-wrap:wrap;
  }
  .compliance-strip span { display:flex; align-items:center; gap:6px; }
  .c-dot { width:7px;height:7px;border-radius:50%;background:#2ecc71; }

  /* RESPONSIVE */
  @media(max-width:768px) {
    .ai-layout { grid-template-columns:1fr; }
    .ov-grid { grid-template-columns:1fr 1fr; }
    .charts-row { grid-template-columns:1fr; }
    .admin-sidebar { width:60px; }
    .sidebar-link span { display:none; }
    nav { padding:0 1rem; }
    .nav-links { display:none; }
  }
  @media(max-width:480px) {
    .ov-grid { grid-template-columns:1fr; }
    .hero-title { font-size:2rem; }
  }

  /* Order page details */
  .order-detail-tag { background:#e8f4fd; color:var(--primary); font-size:0.72rem; padding:2px 8px; border-radius:4px; font-weight:600; }
  .page-header { margin-bottom:24px; }
  .page-header h2 { font-size:1.5rem; font-weight:800; color:var(--navy); }
  .page-header p { color:var(--text-muted); font-size:0.9rem; }

  /* AI Alert Banner */
  .ai-alert {
    background:#fff8e1; border:1px solid #ffc107; border-radius:10px;
    padding:10px 16px; font-size:0.82rem; color:#856404; margin-bottom:12px;
    display:flex; align-items:center; gap:8px;
  }
  .prescription-warn {
    background:#fff3cd; border:1px solid var(--orange-low); border-radius:10px;
    padding:12px 16px; font-size:0.84rem; color:#865a10;
    display:flex; align-items:center; gap:10px; margin-bottom:12px;
  }
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- CART MODAL -->
<div class="modal-overlay" id="cartModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">üõí Your Cart</div>
      <button class="modal-close" onclick="closeModal('cartModal')">‚úï</button>
    </div>
    <div id="cartItems"></div>
    <div class="cart-total"><span>Total</span><span id="cartTotal">‚Ç¨0.00</span></div>
    <button class="checkout-btn" onclick="checkout()">Proceed to Checkout ‚Üí</button>
  </div>
</div>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="loginModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Sign In</div>
      <button class="modal-close" onclick="closeModal('loginModal')">‚úï</button>
    </div>
    <div class="login-form">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" placeholder="doctor@aiweb.health" />
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input class="form-input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn-primary" onclick="doLogin()">Sign In ‚Äî POST /auth/login</button>
      <p style="font-size:0.78rem;color:var(--text-muted);text-align:center">Demo: admin@aiweb.health / admin123</p>
    </div>
  </div>
</div>

<!-- NAVBAR -->
<nav id="mainNav">
  <div class="nav-logo" onclick="showPage('home')">
    <div class="dot"></div>
    AI Web System
  </div>
  <div class="nav-links">
    <button class="nav-link active" onclick="showPage('home')">Home</button>
    <button class="nav-link" onclick="showPage('ai')">AI Assistant</button>
    <button class="nav-link" onclick="showPage('admin')">Admin Panel</button>
    <button class="nav-link" onclick="showPage('about')">About Us</button>
    <button class="nav-link" onclick="showPage('safety')">Safety</button>
  </div>
  <div class="nav-right">
    <button class="cart-btn" onclick="openModal('cartModal')">
      üõí Cart
      <span class="cart-count" id="cartCount">0</span>
    </button>
    <button class="btn-login" onclick="openModal('loginModal')">Login</button>
  </div>
</nav>

<!-- ===========================
     PAGE: HOME
=========================== -->
<div class="page active" id="page-home">
  <!-- Animated particles background -->
  <div class="hero-particles" id="particles"></div>
  
  <div class="hero-content">
    <div class="hero-badge">
      <span class="dot" style="width:8px;height:8px;background:var(--green-ok);border-radius:50%;animation:pulse-dot 2s infinite"></span>
      AI Compliance Engine Active
    </div>
    
    <h1 class="hero-title">
      AI-Powered<br><span>Intelligent Pharmacy</span><br>System
    </h1>
    
    <p class="hero-sub">
      Automated compliance. Predictive restocking. Voice-enabled AI assistance.
      The regulated pharmacy platform built for the modern healthcare ecosystem.
    </p>
    
    <div class="hero-ctas">
      <button class="btn-primary" onclick="showPage('ai')">ü§ñ Talk to AI Assistant</button>
      <button class="btn-secondary" onclick="scrollToProducts()">Browse Medicines</button>
    </div>
    
    <div class="hero-search-wrap">
      <input class="hero-search" type="text" id="heroSearch" placeholder="Search medicines, supplements, prescriptions..." oninput="heroSearchHandler(this.value)" />
      <span class="search-icon">üîç</span>
    </div>
    
    <div class="hero-badges">
      <div class="h-badge"><span class="icon">‚úî</span> Prescription Compliance Engine</div>
      <div class="h-badge"><span class="icon">‚úî</span> Real-Time Inventory AI</div>
      <div class="h-badge"><span class="icon">‚úî</span> Observability Enabled</div>
      <div class="h-badge"><span class="icon">‚úî</span> Prescription Protected</div>
    </div>

    <div class="hero-stats">
      <div class="stat-card">
        <div class="stat-num">52+</div>
        <div class="stat-label">Products in Stock</div>
      </div>
      <div class="stat-card">
        <div class="stat-num">99.7%</div>
        <div class="stat-label">Compliance Rate</div>
      </div>
      <div class="stat-card">
        <div class="stat-num">24/7</div>
        <div class="stat-label">AI Agent Active</div>
      </div>
    </div>

    <div class="scroll-ind">‚Üì</div>
  </div>

  <!-- PRODUCTS SECTION -->
  <div class="section" id="productsSection">
    <div class="compliance-strip">
      <span><span class="c-dot"></span> AI Compliance Engine Active</span>
      <span><span class="c-dot"></span> Prescription Protection ON</span>
      <span><span class="c-dot" style="background:#f39c12"></span> 3 Low Stock Alerts</span>
      <span><span class="c-dot"></span> Observability: Enabled</span>
    </div>
    <br>
    <h2 class="section-title">Our Medicines & Products</h2>
    <p class="section-sub">GET /products ‚Äî Browse our verified pharmaceutical catalogue</p>
    
    <div class="search-bar-wrap">
      <input class="admin-search" type="text" id="productSearch" placeholder="Search products..." oninput="filterProducts(this.value)" />
      <button class="filter-btn">Filter by Category</button>
      <button class="filter-btn">Sort by Price</button>
    </div>
    
    <div class="products-grid" id="productsGrid"></div>
  </div>
</div>

<!-- ===========================
     PAGE: AI ASSISTANT
=========================== -->
<div class="page" id="page-ai">
  <!-- Notification Bar -->
  <div class="notif-bar">
    <span class="badge">üîî LIVE</span>
    <div class="notif-scroll" id="notifScroll">
      <span>üíä Paracetamol 500mg ‚Äî Price reduced 15% this week</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>‚ö†Ô∏è Ibuprofen: Low Stock ‚Äî Order recommended by AI</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>üÜï NORSAN Omega-3 Total ‚Äî Most ordered this week</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>‚úÖ Kijimea Reizdarm PRO ‚Äî Back in Stock</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>üìâ Vitasprint Pro Energie ‚Äî 20% off today only</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>üíä Paracetamol 500mg ‚Äî Price reduced 15% this week</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>‚ö†Ô∏è Ibuprofen: Low Stock ‚Äî Order recommended by AI</span>
      <span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <span>üÜï NORSAN Omega-3 Total ‚Äî Most ordered this week</span>
    </div>
  </div>
  
  <!-- Order Meds bar -->
  <div class="order-meds-bar">
    <span style="font-size:0.82rem;color:var(--text-muted)">Quick Order:</span>
    <button class="order-meds-btn" onclick="orderMeds()">+ Order Meds ‚Äî POST /orders/create</button>
    <button class="vcall-btn" id="vapiCallBtn" onclick="startVoiceCall()">üìû Voice Call AI ‚Äî Vapi SDK</button>
  </div>

  <div class="compliance-strip">
    <span><span class="c-dot"></span> AI Pharmacy Agent: Operational</span>
    <span><span class="c-dot"></span> Compliance Monitoring: ON</span>
    <span><span class="c-dot" style="background:#f39c12"></span> Monthly Limit Checks: Active</span>
    <span><span class="c-dot"></span> Prescription Engine: Running</span>
  </div>

  <div class="ai-layout">
    <!-- Chat Panel -->
    <div class="chat-panel">
      <div class="chat-header">
        <div class="chat-header-left">
          <div class="ai-avatar">ü§ñ</div>
          <div>
            <div class="chat-title">AI Pharmacy Agent</div>
            <div class="chat-sub">Voice & Text Assistant ‚Äî POST /chat-agent</div>
          </div>
        </div>
        <div class="status-row">
          <div class="status-dot"></div>
          <div class="status-text">Active</div>
          <div class="compliance-badge">Compliance: ON</div>
        </div>
      </div>
      
      <div class="chat-messages" id="chatMessages">
        <div class="system-event">‚ö° AI Pharmacy Agent initialized ‚Äî All systems operational</div>
        <div class="msg ai">
          <div class="msg-avatar">ü§ñ</div>
          <div>
            <div class="msg-bubble">Hello! I'm your AI Pharmacy Assistant. I can help you order medications, check prescriptions, verify stock, and provide medication guidance. How can I assist you today?</div>
            <div class="intent-tag">Intent: greeting | Compliance: OK</div>
          </div>
        </div>
      </div>

      <div style="padding:0 14px 10px;">
        <div id="prescriptionWarn" class="prescription-warn" style="display:none">
          ‚ö†Ô∏è <strong>Prescription Required</strong> ‚Äî Upload to Proceed: <button onclick="uploadPrescription()" style="background:var(--orange-low);color:#fff;border:none;border-radius:6px;padding:3px 10px;cursor:pointer;font-size:0.78rem;font-weight:600;margin-left:8px">Upload ‚Äî POST /upload-prescription</button>
        </div>
      </div>
      
      <div class="chat-footer">
        <button class="voice-btn" id="voiceBtn" title="Voice Input ‚Äî Vapi SDK" onclick="toggleVoice()">üéôÔ∏è</button>
        <input class="chat-input" id="chatInput" type="text" placeholder="Speak or type your request... (POST /chat-agent)" onkeydown="if(event.key==='Enter')sendChat()" />
        <button class="send-btn" onclick="sendChat()">Send</button>
      </div>
    </div>

    <!-- Admin Mini + AI Insights -->
    <div style="display:flex;flex-direction:column;gap:20px;">
      <div class="admin-mini">
        <div class="mini-title">üìä Live Dashboard Snapshot</div>
        <div class="mini-stats">
          <div class="mini-stat"><div class="mini-stat-num">‚Ç¨4,287</div><div class="mini-stat-label">Today's Revenue</div></div>
          <div class="mini-stat"><div class="mini-stat-num">38</div><div class="mini-stat-label">Orders Today</div></div>
          <div class="mini-stat"><div class="mini-stat-num">3</div><div class="mini-stat-label">Low Stock</div></div>
          <div class="mini-stat"><div class="mini-stat-num">4</div><div class="mini-stat-label">Prescription Blocks</div></div>
        </div>
        
        <div style="font-size:0.82rem;font-weight:700;color:var(--text-muted);margin-bottom:10px;text-transform:uppercase;letter-spacing:0.5px">Inventory ‚Äî GET /inventory/status</div>
        <table class="stock-table">
          <tr><th>Medicine</th><th>Stock</th><th>Status</th></tr>
          <tr><td>Paracetamol 500mg</td><td>124</td><td><span class="status-badge s-green">In Stock</span></td></tr>
          <tr><td>NORSAN Omega-3</td><td>18</td><td><span class="status-badge s-orange">Low Stock</span></td></tr>
          <tr><td>Ibuprofen 400mg</td><td>5</td><td><span class="status-badge s-red">Critical</span></td></tr>
          <tr><td>Cetirizin HEXAL</td><td>67</td><td><span class="status-badge s-green">In Stock</span></td></tr>
          <tr><td>Amoxicillin</td><td>3</td><td><span class="status-badge s-red">Critical</span></td></tr>
        </table>
        
        <div class="ai-insights">
          <div class="ai-insights-title">üß† AI Insights ‚Äî GET /ai/insights</div>
          <div class="insight-row"><span>Refill Risk Users</span><span class="insight-val">12</span></div>
          <div class="insight-row"><span>Prescription Blocks Today</span><span class="insight-val">4</span></div>
          <div class="insight-row"><span>Low Stock AI Alerts</span><span class="insight-val">2</span></div>
          <div class="insight-row"><span>Monthly Limit Violations</span><span class="insight-val">1</span></div>
          <div class="insight-row" style="border:none"><span>AI Compliance Score</span><span class="insight-val" style="color:var(--green-ok)">98.2%</span></div>
        </div>
      </div>
      
      <!-- Recent Orders Quick View -->
      <div class="admin-mini">
        <div class="mini-title">üì¶ Recent Orders ‚Äî GET /orders/recent</div>
        <div id="recentOrdersAI" style="font-size:0.83rem;"></div>
      </div>
    </div>
  </div>
</div>

<!-- ===========================
     PAGE: ADMIN
=========================== -->
<div class="page" id="page-admin">
  <!-- Top notification -->
  <div class="notif-bar">
    <span class="badge">‚ö° ADMIN</span>
    <div class="notif-scroll" id="adminNotifScroll">
      <span>üî¥ AI Alert: Ibuprofen ‚Äî Restock Recommended immediately</span>
      <span>&nbsp;|&nbsp;</span>
      <span>üß† AI Suggestion: PAT002 due for Omega-3 refill in 3 days</span>
      <span>&nbsp;|&nbsp;</span>
      <span>üö´ AI Compliance Triggered: Prescription required ‚Äî Ramipril order blocked</span>
      <span>&nbsp;|&nbsp;</span>
      <span>üìä Weekly Top Seller: NORSAN Omega-3 Total (32 units)</span>
      <span>&nbsp;|&nbsp;</span>
      <span>üî¥ AI Alert: Ibuprofen ‚Äî Restock Recommended immediately</span>
      <span>&nbsp;|&nbsp;</span>
      <span>üß† AI Suggestion: PAT002 due for Omega-3 refill in 3 days</span>
    </div>
  </div>

  <div class="admin-layout">
    <div class="admin-sidebar">
      <div class="sidebar-logo">
        <span>üè•</span> <span>AI Web System</span>
      </div>
      <div class="sidebar-nav">
        <div class="sidebar-link active" onclick="showAdminPanel('overview')"><span>üìä</span><span>Overview</span></div>
        <div class="sidebar-link" onclick="showAdminPanel('orders')"><span>üì¶</span><span>Orders</span></div>
        <div class="sidebar-link" onclick="showAdminPanel('products')"><span>üíä</span><span>Products</span></div>
        <div class="sidebar-link" onclick="showAdminPanel('customers')"><span>üë•</span><span>Customers</span></div>
        <div class="sidebar-link" onclick="showAdminPanel('stock')"><span>üì¶</span><span>Stock</span></div>
        <div class="sidebar-link" onclick="showAdminPanel('sales')"><span>üí∞</span><span>Sales</span></div>
        <div class="sidebar-link" onclick="showAdminPanel('aiinsights')"><span>üß†</span><span>AI Insights</span></div>
      </div>
    </div>

    <div class="admin-main">
      <!-- OVERVIEW -->
      <div class="admin-panel active" id="panel-overview">
        <div class="page-header">
          <h2>Sales Overview ‚Äî GET /admin/overview</h2>
          <p>Real-time pharmacy intelligence dashboard</p>
        </div>
        <div class="ov-grid">
          <div class="ov-card">
            <div class="ov-card-label">Total Revenue</div>
            <div class="ov-card-val">‚Ç¨112,200</div>
            <div class="ov-card-change up">‚Üë +2% since last week</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Total Profit</div>
            <div class="ov-card-val">‚Ç¨12,500</div>
            <div class="ov-card-change up">‚Üë +8% since last week</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Total Orders</div>
            <div class="ov-card-val">1,284</div>
            <div class="ov-card-change up">‚Üë +5% since last week</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Avg Order Value</div>
            <div class="ov-card-val">‚Ç¨96.50</div>
            <div class="ov-card-change down">‚Üì -0.2% since last week</div>
          </div>
        </div>

        <div class="charts-row">
          <div class="chart-card">
            <div class="chart-title">
              Total Revenue
              <select style="font-size:0.8rem;border:1px solid var(--border);border-radius:8px;padding:4px 8px;outline:none">
                <option>This Month</option><option>Last Month</option><option>This Year</option>
              </select>
            </div>
            <div class="bar-chart" id="revenueChart"></div>
            <div style="display:flex;gap:6px;margin-top:4px" id="revenueLabels"></div>
          </div>
          <div class="chart-card">
            <div class="chart-title">AI Compliance</div>
            <div style="padding:10px 0">
              <div class="insight-row"><span style="font-size:0.82rem">Prescription Blocks</span><span class="insight-val">4 today</span></div>
              <div class="insight-row"><span style="font-size:0.82rem">Low Stock Alerts</span><span class="insight-val">2</span></div>
              <div class="insight-row"><span style="font-size:0.82rem">Limit Violations</span><span class="insight-val">1</span></div>
              <div class="insight-row"><span style="font-size:0.82rem">Refill Risks</span><span class="insight-val">12</span></div>
              <div style="margin-top:12px;background:#f0f6ff;border-radius:10px;padding:12px">
                <div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:6px">AI Compliance Score</div>
                <div style="background:#e1e8f0;border-radius:6px;height:8px;overflow:hidden">
                  <div style="background:var(--green-ok);width:98.2%;height:100%;border-radius:6px;animation:expand-line 2s ease"></div>
                </div>
                <div style="font-size:0.9rem;font-weight:800;color:var(--green-ok);margin-top:6px">98.2%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Alerts -->
        <div class="ai-alert">‚ö° AI Alert: Restock Recommended ‚Äî Ibuprofen (5 units left)</div>
        <div class="ai-alert">üß† AI Suggestion: 12 users have refill risk this week ‚Äî Send reminder</div>

        <!-- Recent Orders Table -->
        <div class="data-card">
          <div class="data-card-header">
            <div style="font-size:1rem;font-weight:700;color:var(--navy)">Recent Orders ‚Äî GET /orders</div>
            <button class="filter-btn" onclick="showAdminPanel('orders')">View All ‚Üí</button>
          </div>
          <div id="overviewOrdersTable"></div>
        </div>

        <!-- Top Products -->
        <div class="data-card">
          <div class="data-card-header">
            <div style="font-size:1rem;font-weight:700;color:var(--navy)">Top Products ‚Äî GET /products/top</div>
          </div>
          <div id="topProductsTable"></div>
        </div>
      </div>

      <!-- ORDERS -->
      <div class="admin-panel" id="panel-orders">
        <div class="page-header">
          <h2>Orders Management ‚Äî GET /orders</h2>
          <p>All customer orders imported from order data</p>
        </div>
        <div class="search-bar-wrap">
          <input class="admin-search" type="text" id="ordersSearch" placeholder="Search orders..." oninput="filterOrders(this.value)"/>
          <button class="filter-btn">Export CSV ‚Äî GET /orders/export</button>
          <button class="btn-primary" style="padding:10px 18px;font-size:0.85rem" onclick="showToast('POST /orders/create ‚Äî Order creation endpoint')">+ New Order</button>
        </div>
        <div class="data-card">
          <table class="data-table" id="ordersTable">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Product Name</th>
                <th>PZN</th>
                <th>Price</th>
                <th>Size</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ordersBody"></tbody>
          </table>
        </div>
      </div>

      <!-- PRODUCTS -->
      <div class="admin-panel" id="panel-products">
        <div class="page-header">
          <h2>Products ‚Äî GET /products</h2>
          <p>Manage your pharmaceutical product catalogue</p>
        </div>
        <div class="search-bar-wrap">
          <input class="admin-search" type="text" id="productsAdminSearch" placeholder="Search products..." oninput="filterAdminProducts(this.value)"/>
          <button class="btn-primary" style="padding:10px 18px;font-size:0.85rem" onclick="showToast('POST /products ‚Äî Add product endpoint')">+ Add Product</button>
        </div>
        <div class="data-card">
          <table class="data-table">
            <thead>
              <tr><th>ID</th><th>Name</th><th>Price</th><th>Size</th><th>Prescription</th><th>Stock</th><th>Actions</th></tr>
            </thead>
            <tbody id="adminProductsBody"></tbody>
          </table>
        </div>
      </div>

      <!-- CUSTOMERS -->
      <div class="admin-panel" id="panel-customers">
        <div class="page-header">
          <h2>Customers ‚Äî GET /customers</h2>
          <p>Patient demographics and purchase history</p>
        </div>
        <div class="search-bar-wrap">
          <input class="admin-search" type="text" id="customersSearch" placeholder="Search patients..." oninput="filterCustomers(this.value)"/>
          <button class="filter-btn">Export ‚Äî GET /customers/export</button>
        </div>
        <div class="data-card">
          <table class="data-table">
            <thead>
              <tr><th>Patient ID</th><th>Age</th><th>Gender</th><th>Last Order</th><th>Product</th><th>Qty</th><th>Total</th><th>Rx Needed</th></tr>
            </thead>
            <tbody id="customersBody"></tbody>
          </table>
        </div>
      </div>

      <!-- STOCK -->
      <div class="admin-panel" id="panel-stock">
        <div class="page-header">
          <h2>Stock Management ‚Äî GET /inventory</h2>
          <p>Monitor and adjust medicine inventory levels</p>
        </div>
        <div class="search-bar-wrap">
          <input class="admin-search" type="text" id="stockSearch" placeholder="Search medicines..." oninput="filterStock(this.value)"/>
        </div>
        <div class="stock-grid" id="stockGrid"></div>
      </div>

      <!-- SALES -->
      <div class="admin-panel" id="panel-sales">
        <div class="page-header">
          <h2>Sales Analytics ‚Äî GET /sales/analytics</h2>
          <p>Revenue trends and performance metrics</p>
        </div>
        <div class="ov-grid">
          <div class="ov-card">
            <div class="ov-card-label">Total Revenue</div>
            <div class="ov-card-val">‚Ç¨112,200</div>
            <div class="ov-card-change up">‚Üë +2%</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Total Profit</div>
            <div class="ov-card-val">‚Ç¨12,500</div>
            <div class="ov-card-change up">‚Üë +8%</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Total Cost</div>
            <div class="ov-card-val">‚Ç¨48,200</div>
            <div class="ov-card-change down">‚Üì -0.2%</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Avg Order Value</div>
            <div class="ov-card-val">‚Ç¨96.50</div>
            <div class="ov-card-change up">‚Üë +5%</div>
          </div>
        </div>
        <div class="data-card">
          <div class="chart-title">Revenue by Month ‚Äî GET /sales/monthly</div>
          <div class="bar-chart" id="salesBarChart" style="height:180px"></div>
          <div style="display:flex;gap:6px;margin-top:4px" id="salesBarLabels"></div>
        </div>
        <div class="data-card">
          <div class="data-card-header">
            <div style="font-size:1rem;font-weight:700;color:var(--navy)">Top Selling Products</div>
          </div>
          <table class="data-table">
            <thead><tr><th>Rank</th><th>Medicine</th><th>Units Sold</th><th>Revenue</th></tr></thead>
            <tbody>
              <tr><td>1</td><td>NORSAN Omega-3 Total</td><td>359</td><td>‚Ç¨9,693</td></tr>
              <tr><td>2</td><td>Kijimea Reizdarm PRO</td><td>300</td><td>‚Ç¨11,697</td></tr>
              <tr><td>3</td><td>Mucosolvan Retardkapseln</td><td>289</td><td>‚Ç¨11,551</td></tr>
              <tr><td>4</td><td>OMNi-BiOTiC SR-9</td><td>248</td><td>‚Ç¨11,036</td></tr>
              <tr><td>5</td><td>Paracetamol 500mg</td><td>220</td><td>‚Ç¨453</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- AI INSIGHTS -->
      <div class="admin-panel" id="panel-aiinsights">
        <div class="page-header">
          <h2>AI Insights ‚Äî GET /ai/insights</h2>
          <p>Intelligent recommendations and compliance engine output</p>
        </div>
        <div class="ov-grid">
          <div class="ov-card">
            <div class="ov-card-label">Refill Risk Users</div>
            <div class="ov-card-val" style="color:var(--orange-low)">12</div>
            <div class="ov-card-change" style="color:var(--text-muted)">This week</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Prescription Blocks</div>
            <div class="ov-card-val" style="color:var(--red-critical)">4</div>
            <div class="ov-card-change" style="color:var(--text-muted)">Today</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Low Stock Alerts</div>
            <div class="ov-card-val" style="color:var(--orange-low)">2</div>
            <div class="ov-card-change" style="color:var(--text-muted)">Active now</div>
          </div>
          <div class="ov-card">
            <div class="ov-card-label">Monthly Violations</div>
            <div class="ov-card-val" style="color:var(--red-critical)">1</div>
            <div class="ov-card-change" style="color:var(--text-muted)">This month</div>
          </div>
        </div>
        <div class="data-card">
          <div class="mini-title">üß† AI Recommendations ‚Äî GET /ai/recommendations</div>
          <div class="ai-alert">‚ö° AI Alert: Restock Recommended ‚Äî Ibuprofen (5 remaining) ‚Äî POST /inventory/restock</div>
          <div class="ai-alert">‚ö° AI Alert: Restock Recommended ‚Äî Amoxicillin (3 remaining) ‚Äî POST /inventory/restock</div>
          <div class="ai-alert">üß† AI Suggestion: 12 patients have refill risk ‚Äî Notify via POST /notifications/send</div>
          <div class="ai-alert">üö´ AI Compliance Triggered: Ramipril order blocked (Prescription required) ‚Äî GET /compliance/log</div>
          <div class="ai-alert">üìä AI Prediction: Weekend demand spike for Paracetamol (+23%) ‚Äî Stock up now</div>
        </div>
        <div class="data-card">
          <div class="mini-title">üìä Compliance Log ‚Äî GET /compliance/log</div>
          <table class="data-table">
            <thead><tr><th>Time</th><th>Event</th><th>Patient</th><th>Medicine</th><th>Action</th></tr></thead>
            <tbody>
              <tr><td>14:23</td><td><span class="status-badge s-red">Blocked</span></td><td>PAT006</td><td>Ramipril 10mg</td><td>Prescription required</td></tr>
              <tr><td>13:10</td><td><span class="status-badge s-orange">Warning</span></td><td>PAT004</td><td>Mucosolvan</td><td>Monthly limit warning</td></tr>
              <tr><td>11:45</td><td><span class="status-badge s-green">Approved</span></td><td>PAT001</td><td>Panthenol Spray</td><td>Compliant order</td></tr>
              <tr><td>10:30</td><td><span class="status-badge s-red">Blocked</span></td><td>PAT008</td><td>Minoxidil Spray</td><td>Prescription required</td></tr>
              <tr><td>09:15</td><td><span class="status-badge s-green">Approved</span></td><td>PAT005</td><td>Paracetamol</td><td>Compliant order</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===========================
     PAGE: ABOUT
=========================== -->
<div class="page" id="page-about">
  <div style="padding-top:64px">
    <div class="about-hero">
      <h1>About AI Web System</h1>
      <p>Pioneering the intersection of artificial intelligence and pharmaceutical care for a healthier, safer world.</p>
    </div>
    <div class="about-body">
      <div class="about-section">
        <h2>Our Mission</h2>
        <p>AI Web System was founded with a singular purpose: to revolutionize how pharmaceutical services are delivered in the digital age. We believe that every person deserves access to safe, verified, and intelligently managed medication ‚Äî and that technology, when thoughtfully applied, can make that vision a reality.</p>
        <p>Our platform combines cutting-edge artificial intelligence with rigorous pharmaceutical standards to create a system that doesn't just sell medicines ‚Äî it actively protects patients, ensures compliance, and anticipates healthcare needs before they become problems.</p>
      </div>
      <div class="about-section">
        <h2>AI-Powered Compliance Engine</h2>
        <p>At the heart of AI Web System is our proprietary Compliance Engine ‚Äî a sophisticated AI system that monitors every transaction in real time. When a customer attempts to purchase a prescription medication without a valid prescription, our system automatically flags and blocks the order, ensuring that no unsafe medication dispensing occurs. This isn't just a checkbox ‚Äî it's a fundamental commitment to patient safety.</p>
        <p>The engine also monitors for monthly dosage limits, tracks refill patterns, and identifies patients who may be at risk of medication dependency or adverse interactions. This proactive approach has achieved a 98.2% compliance score across all transactions.</p>
      </div>
      <div class="about-section">
        <h2>Predictive Inventory Intelligence</h2>
        <p>Our AI doesn't just react to inventory changes ‚Äî it predicts them. By analyzing historical ordering patterns, seasonal health trends, and real-time demand signals, our system can anticipate stock shortages days before they occur. Pharmacists receive intelligent reorder recommendations with confidence scores, allowing them to maintain optimal inventory levels without overstocking or running dry on critical medications.</p>
        <p>This predictive capability has reduced stock-out incidents by over 67% for our partner pharmacies, and has helped save thousands of euros in holding costs by optimizing order quantities.</p>
      </div>
      <div class="about-section">
        <h2>Voice-Enabled AI Pharmacy Assistant</h2>
        <p>We've integrated Vapi's cutting-edge voice AI technology to create a truly conversational pharmacy experience. Patients can speak naturally to place orders, ask about medication interactions, inquire about dosage instructions, or request refill reminders ‚Äî all in natural language, without navigating complex menus or forms.</p>
        <p>The voice assistant is trained on comprehensive pharmaceutical databases and is capable of understanding complex medication names, dosage terminology, and patient-specific contexts. It seamlessly integrates with our compliance engine, ensuring that all voice-initiated orders are subject to the same rigorous safety checks as manual orders.</p>
      </div>
      <div class="about-section">
        <h2>Our Technology Stack</h2>
        <p>AI Web System is built on a modern, scalable microservices architecture. Our backend REST API provides comprehensive endpoints for chat agents (POST /chat-agent), prescription management (POST /upload-prescription), inventory monitoring (GET /inventory/status), order processing (POST /orders/create), and AI insights generation (GET /ai/insights). All APIs follow OpenAPI specifications and include comprehensive authentication, rate limiting, and audit logging.</p>
        <p>Our observability layer provides real-time dashboards for pharmacy administrators, enabling instant visibility into system health, transaction volumes, compliance events, and AI model performance. We use industry-standard monitoring tools to ensure 99.9% uptime SLAs for all critical pharmaceutical operations.</p>
      </div>
      <div class="about-section">
        <h2>Regulatory Compliance & Certifications</h2>
        <p>AI Web System operates in full compliance with European pharmaceutical regulations (EU Directive 2001/83/EC and its amendments), GDPR for patient data protection, and all applicable national pharmacy laws. Our systems are regularly audited by independent pharmaceutical compliance experts, and we maintain ISO 27001 certification for information security management.</p>
        <p>We work closely with regulatory bodies across Europe to ensure that our AI-driven approach to pharmaceutical services remains at the forefront of both innovation and compliance. Our commitment is not just to build great technology ‚Äî it's to build technology that regulators, pharmacists, and patients can trust completely.</p>
      </div>
      <div class="about-section">
        <h2>Our Team</h2>
        <p>AI Web System was founded by a multidisciplinary team of pharmacists, software engineers, AI researchers, and healthcare compliance specialists. Our combined experience spans pharmaceutical operations, machine learning, healthcare IT systems, and regulatory affairs across more than 15 countries. We are united by a shared belief that the pharmacy of the future must be intelligent, safe, and accessible to all.</p>
      </div>
    </div>
  </div>
</div>

<!-- ===========================
     PAGE: SAFETY
=========================== -->
<div class="page" id="page-safety">
  <div style="padding-top:64px">
    <div class="about-hero">
      <h1>Safety & Maintenance</h1>
      <p>Our comprehensive framework for ensuring pharmaceutical safety, system reliability, and patient protection.</p>
    </div>
    <div class="section">
      <div class="safety-grid">
        <div class="safety-card">
          <div class="safety-icon">üîí</div>
          <h3>Prescription Verification</h3>
          <p>All prescription-required medications are automatically blocked by our AI Compliance Engine until a valid prescription is uploaded and verified. Our system cross-references prescriptions against our verification database in real time, ensuring zero unauthorized dispensing of controlled substances.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üß†</div>
          <h3>AI Drug Interaction Monitoring</h3>
          <p>Our AI scans every order against the patient's purchase history to detect potential dangerous drug interactions. Using comprehensive pharmaceutical databases updated daily, the system flags any combination that may pose a health risk, alerting both the patient and pharmacy staff.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üìä</div>
          <h3>Monthly Dosage Limits</h3>
          <p>The system enforces monthly quantity limits for all medications, particularly those with dependency potential. When a patient's monthly threshold is approached, progressive warnings are issued. Upon reaching the limit, orders are automatically blocked until the next calendar period begins.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üîê</div>
          <h3>Data Security & GDPR</h3>
          <p>All patient data is encrypted at rest and in transit using AES-256 and TLS 1.3 respectively. We maintain strict GDPR compliance with full data subject rights management, automated data retention policies, and comprehensive audit trails for all data access events. Patient data is never shared with third parties without explicit consent.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">‚ö°</div>
          <h3>System Uptime & Reliability</h3>
          <p>AI Web System maintains a 99.9% uptime SLA backed by redundant infrastructure across multiple availability zones. Our automated failover systems ensure that even during maintenance windows, pharmacy operations continue uninterrupted. All system health metrics are monitored 24/7 by our operations team.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üè•</div>
          <h3>Emergency Protocols</h3>
          <p>In the event of system anomalies or critical failures, our emergency protocol automatically escalates to human pharmacist oversight. No patient order is lost during failover events, and all pending prescriptions are queued for manual review when automated processing is temporarily unavailable.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üîÑ</div>
          <h3>Regular Maintenance & Updates</h3>
          <p>Our pharmaceutical database receives daily updates to ensure all drug information, interaction data, and regulatory changes are reflected immediately. AI model updates undergo rigorous testing in staging environments before production deployment, including compliance validation, safety testing, and performance benchmarking.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üìã</div>
          <h3>Audit & Compliance Logging</h3>
          <p>Every transaction, compliance event, and AI decision is logged with full traceability. Our immutable audit logs are retained for the legally required periods and are available for regulatory inspection at any time. The compliance log includes timestamps, patient IDs (anonymized for reporting), decision rationale, and outcome tracking.</p>
        </div>
        <div class="safety-card">
          <div class="safety-icon">üë®‚Äç‚öïÔ∏è</div>
          <h3>Pharmacist Oversight Integration</h3>
          <p>AI Web System is designed to augment, not replace, professional pharmacist judgment. Critical decisions are always subject to pharmacist review, and our AI recommendations include confidence scores and reasoning transparency. Pharmacists can override AI recommendations with appropriate documentation for audit purposes.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ===== DATA =====
const PRODUCTS = [
  {id:16066,name:"Panthenol Spray 46.3mg Schaum",price:16.95,size:"130 g",desc:"Skin foam promoting regeneration of irritated skin with moisturizing properties.",rx:false,stock:87},
  {id:976308,name:"NORSAN Omega-3 Total",price:27,size:"200 ml",desc:"Liquid Omega-3 fish oil supporting heart, brain and joints.",rx:false,stock:18},
  {id:977179,name:"NORSAN Omega-3 Vegan",price:29,size:"100 ml",desc:"Plant-based Omega-3 from algae. Suitable for vegetarians and vegans.",rx:false,stock:42},
  {id:993687,name:"NORSAN Omega-3 Kapseln",price:29,size:"120 st",desc:"Omega-3 capsules for daily nutritional supplementation.",rx:false,stock:55},
  {id:1225428,name:"Vividrin antiallergische Augentropfen",price:8.28,size:"30x0.5 ml",desc:"Preservative-free eye drops for allergic symptoms like itching and redness.",rx:false,stock:120},
  {id:202796,name:"Aqualibra 80mg Filmtabletten",price:27.82,size:"60 st",desc:"Herbal medicine supporting bladder function.",rx:false,stock:34},
  {id:1103035,name:"Vitasprint Pro Energie",price:15.95,size:"8 st",desc:"Dietary supplement with B-vitamins and amino acids to reduce fatigue.",rx:false,stock:29},
  {id:27955,name:"Cystinol akut",price:26.5,size:"60 st",desc:"Herbal medicine for treatment of acute urinary tract infections.",rx:false,stock:61},
  {id:1162261,name:"Kijimea Reizdarm PRO",price:38.99,size:"28 st",desc:"Medical product for irritable bowel syndrome symptom relief.",rx:false,stock:44},
  {id:1204782,name:"Mucosolvan Retardkapseln",price:39.97,size:"50 st",desc:"Long-acting mucus dissolving medication for coughs.",rx:true,stock:23},
  {id:1210016,name:"OMNi-BiOTiC SR-9 mit B-Vitaminen",price:44.5,size:"28x3 g",desc:"Probiotic with B-vitamins supporting intestinal flora.",rx:false,stock:38},
  {id:1329121,name:"Paracetamol 500mg Tabletten",price:2.06,size:"20 st",desc:"Pain and fever reducing medication. Common OTC analgesic.",rx:false,stock:124},
  {id:1293377,name:"Augentropfen RedCare",price:12.69,size:"10 ml",desc:"Moisturizing eye drops for dry or irritated eyes.",rx:false,stock:93},
  {id:1358905,name:"COLPOFIX Vaginalgel",price:49.6,size:"40 ml",desc:"Vaginal gel supporting cervical mucous membrane health.",rx:true,stock:15},
  {id:1319766,name:"SAW PALMETO 350mg",price:8.47,size:"100 st",desc:"Herbal supplement supporting prostate function.",rx:false,stock:78},
];

const CUSTOMERS = [
  {id:"PAT001",age:45,gender:"F",date:"2024-03-15",product:"Panthenol Spray",qty:1,total:16.95,freq:"Once daily",rx:"No"},
  {id:"PAT002",age:62,gender:"M",date:"2024-03-14",product:"NORSAN Omega-3 Total",qty:2,total:54,freq:"Once daily",rx:"No"},
  {id:"PAT003",age:38,gender:"F",date:"2024-03-14",product:"Vividrin Augentropfen",qty:1,total:8.28,freq:"Twice daily",rx:"No"},
  {id:"PAT004",age:55,gender:"M",date:"2024-03-13",product:"Mucosolvan Retardkapseln",qty:1,total:39.97,freq:"Once daily",rx:"Yes"},
  {id:"PAT005",age:29,gender:"F",date:"2024-03-12",product:"Paracetamol 500mg",qty:3,total:6.18,freq:"As needed",rx:"No"},
  {id:"PAT006",age:71,gender:"M",date:"2024-03-09",product:"Ramipril 10mg",qty:2,total:25.18,freq:"Once daily",rx:"Yes"},
  {id:"PAT007",age:33,gender:"F",date:"2024-03-09",product:"Centrum Vital+",qty:1,total:19.95,freq:"Once daily",rx:"No"},
  {id:"PAT008",age:42,gender:"M",date:"2024-03-08",product:"Minoxidil Spray",qty:1,total:22.5,freq:"Twice daily",rx:"Yes"},
  {id:"PAT009",age:58,gender:"F",date:"2024-03-06",product:"Prostata Men Kapseln",qty:1,total:19.99,freq:"Twice daily",rx:"No"},
  {id:"PAT010",age:27,gender:"F",date:"2024-03-05",product:"Natural Intimate Creme",qty:1,total:18.9,freq:"As needed",rx:"No"},
  {id:"PAT011",age:64,gender:"M",date:"2024-03-03",product:"Cystinol akut",qty:2,total:53,freq:"Three times daily",rx:"No"},
  {id:"PAT012",age:50,gender:"F",date:"2024-03-02",product:"Kijimea Reizdarm PRO",qty:1,total:38.99,freq:"Once daily",rx:"No"},
];

const MONTHLY_REVENUE = [8200,9100,10400,11200,9800,13500,18657,12300,14100,15600,11900,13200];
const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

// CART STATE
let cart = [];
let cartItems_store = [];
let stockData = PRODUCTS.map(p => ({...p, currentStock: p.stock}));
let chatHistory = [];

// ===== PARTICLES =====
function createParticles() {
  const container = document.getElementById('particles');
  const colors = ['#2E86DE','#3AAFB9','#27AE60','#1B3A57'];
  for(let i=0;i<25;i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    const size = Math.random()*40+10;
    p.style.cssText = `
      width:${size}px;height:${size}px;
      left:${Math.random()*100}%;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      animation-duration:${Math.random()*15+10}s;
      animation-delay:${Math.random()*10}s;
    `;
    container.appendChild(p);
  }
}
createParticles();

// ===== CHARTS =====
function buildBarChart(containerId, labelsId, data, labels) {
  const c = document.getElementById(containerId);
  const l = document.getElementById(labelsId);
  if(!c) return;
  const max = Math.max(...data);
  c.innerHTML = data.map((v,i) => `
    <div style="flex:1;display:flex;flex-direction:column;align-items:center">
      <div class="bar" style="height:${(v/max)*100}%;width:100%" title="${labels[i]}: ‚Ç¨${v.toLocaleString()}"></div>
    </div>
  `).join('');
  if(l) l.innerHTML = labels.map(lb=>`<div style="flex:1;text-align:center;font-size:0.65rem;color:var(--text-muted)">${lb}</div>`).join('');
}

// ===== NAVIGATION =====
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
  const navMap = {home:0,ai:1,admin:2,about:3,safety:4};
  const links = document.querySelectorAll('.nav-link');
  if(links[navMap[name]]) links[navMap[name]].classList.add('active');
  window.scrollTo(0,0);
  if(name==='admin') initAdminData();
  if(name==='ai') initAIPage();
}

function showAdminPanel(name) {
  document.querySelectorAll('.admin-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

// ===== PRODUCTS =====
function renderProducts(list) {
  const grid = document.getElementById('productsGrid');
  if(!grid) return;
  grid.innerHTML = list.map(p => `
    <div class="product-card">
      <div class="product-top">
        <div class="product-name">${p.name}</div>
        ${p.rx ? '<span class="rx-badge">Rx Required</span>' : ''}
      </div>
      <div class="product-desc">${p.desc}</div>
      ${p.rx ? '<div class="prescription-warn" style="margin-bottom:8px;padding:8px 12px;font-size:0.78rem">‚ö†Ô∏è Prescription Required</div>' : ''}
      <div class="product-bottom">
        <div>
          <div class="product-price">‚Ç¨${p.price.toFixed(2)}</div>
          <div class="product-size">${p.size}</div>
          <div class="ai-tag">‚ú¶ AI Recommended</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
          <span class="stock-badge ${p.stock > 30 ? 'stock-in' : 'stock-low'}">${p.stock > 30 ? '‚úì In Stock' : '‚ö† Low Stock'}</span>
          <button class="add-cart-btn" onclick='addToCart(${JSON.stringify(p)})'>Add to Cart</button>
        </div>
      </div>
    </div>
  `).join('');
}

function filterProducts(q) {
  const filtered = PRODUCTS.filter(p => p.name.toLowerCase().includes(q.toLowerCase()) || p.desc.toLowerCase().includes(q.toLowerCase()));
  renderProducts(filtered);
}

function heroSearchHandler(q) {
  if(q.length > 2) {
    scrollToProducts();
    filterProducts(q);
  } else {
    renderProducts(PRODUCTS);
  }
}

function scrollToProducts() {
  document.getElementById('productsSection')?.scrollIntoView({behavior:'smooth'});
}

// ===== CART =====
function addToCart(product) {
  if(product.rx) {
    showToast('‚ö†Ô∏è Prescription required ‚Äî POST /upload-prescription');
    document.getElementById('prescriptionWarn').style.display = 'flex';
    return;
  }
  cart.push(product);
  document.getElementById('cartCount').textContent = cart.length;
  showToast(`‚úì ${product.name.substring(0,30)}... added to cart`);
}

function renderCart() {
  const ci = document.getElementById('cartItems');
  if(!cart.length) { ci.innerHTML = '<p style="color:var(--text-muted);text-align:center;padding:20px">Your cart is empty</p>'; document.getElementById('cartTotal').textContent='‚Ç¨0.00'; return; }
  ci.innerHTML = cart.map((item,i) => `
    <div class="cart-item">
      <div class="cart-item-name">${item.name}</div>
      <div class="cart-item-price">‚Ç¨${item.price.toFixed(2)}</div>
      <button class="remove-btn" onclick="removeFromCart(${i})">üóë</button>
    </div>
  `).join('');
  const total = cart.reduce((s,i)=>s+i.price,0);
  document.getElementById('cartTotal').textContent = `‚Ç¨${total.toFixed(2)}`;
}

function removeFromCart(i) { cart.splice(i,1); document.getElementById('cartCount').textContent=cart.length; renderCart(); }

function checkout() {
  showToast('POST /orders/create ‚Äî Order placed! Processing...');
  cart=[];
  document.getElementById('cartCount').textContent=0;
  closeModal('cartModal');
}

// ===== MODALS =====
function openModal(id) {
  document.getElementById(id).classList.add('open');
  if(id==='cartModal') renderCart();
}
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

// ===== LOGIN =====
function doLogin() { showToast('POST /auth/login ‚Äî Signing in...'); setTimeout(()=>{closeModal('loginModal');showToast('‚úì Welcome back, Admin!');},800); }

// ===== TOAST =====
function showToast(msg, duration=3000) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), duration);
}

// ===== CHAT =====
function sendChat() {
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if(!msg) return;
  input.value = '';
  appendMessage('user', msg);
  
  // Check for prescription keywords
  if(/ramipril|minoxidil|prescription|rx/i.test(msg)) {
    setTimeout(()=>{
      document.getElementById('prescriptionWarn').style.display='flex';
      appendSystemEvent('‚ö†Ô∏è AI Compliance Triggered: Prescription required for this medication');
      appendMessage('ai', 'üö´ This medication requires a valid prescription. Please upload your prescription to proceed. Endpoint: POST /upload-prescription', 'compliance | Blocked');
    }, 800);
    return;
  }
  
  if(/ibuprofen|amoxicillin|stock/i.test(msg)) {
    setTimeout(()=>{
      appendSystemEvent('‚ö° AI Alert: Low stock detected ‚Äî Restock notification sent to admin');
      appendMessage('ai', '‚ö†Ô∏è I can see that Ibuprofen is currently at low stock levels (5 units). I\'ve notified the admin team via GET /ai/alerts. Would you like me to suggest an alternative medication?', 'intent: stock_check | Alert: Low Stock');
    }, 700);
    return;
  }

  if(/order|buy|purchase|need/i.test(msg)) {
    setTimeout(()=>{
      appendMessage('ai', '‚úì I can help you place that order! I\'ll process it via POST /orders/create. Let me verify availability and compliance first...', 'intent: order_placement | Compliance: Checking');
      setTimeout(()=>appendSystemEvent('‚úÖ Compliance check passed ‚Äî Order approved'), 1500);
    }, 600);
    return;
  }

  // Default AI response via endpoint
  setTimeout(()=>{
    const responses = [
      "I'm your AI Pharmacy Assistant. I can help with medication orders, prescription verification, stock checks, and dosage guidance. What do you need?",
      "I'll check that for you via our AI agent endpoint (POST /chat-agent). All your requests are processed with full compliance monitoring.",
      "Great question! Based on our pharmaceutical database, I can provide detailed information about this. Shall I also check your order history for relevant context?",
    ];
    appendMessage('ai', responses[Math.floor(Math.random()*responses.length)], 'intent: general_query | Compliance: OK');
  }, 600);
}

function appendMessage(role, text, intentTag='') {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = `msg ${role}`;
  div.innerHTML = `
    <div class="msg-avatar">${role==='ai'?'ü§ñ':'üë§'}</div>
    <div>
      <div class="msg-bubble">${text}</div>
      ${intentTag ? `<div class="intent-tag">${intentTag}</div>` : ''}
    </div>
  `;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function appendSystemEvent(text) {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'system-event';
  div.textContent = text;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

// ===== VOICE =====
let voiceActive = false;
function toggleVoice() {
  voiceActive = !voiceActive;
  const btn = document.getElementById('voiceBtn');
  btn.classList.toggle('active', voiceActive);
  btn.textContent = voiceActive ? '‚èπ' : 'üéôÔ∏è';
  
  if(voiceActive) {
    appendSystemEvent('üéôÔ∏è Vapi Voice SDK activated ‚Äî Listening...');
    showToast('üéôÔ∏è Vapi SDK: vapi.start("ASSISTANT_ID") ‚Äî Listening');
    // Vapi SDK Integration Point:
    // const vapi = new Vapi("YOUR_PUBLIC_API_KEY");
    // vapi.start("YOUR_ASSISTANT_ID");
    setTimeout(()=>{
      if(voiceActive) {
        appendSystemEvent('‚úì Voice processed ‚Äî Converting to text via Vapi...');
        appendMessage('ai', 'üéôÔ∏è Voice input received and processed. I\'m ready to assist with your medication needs. What would you like to order or inquire about?', 'intent: voice_input | Vapi: Active');
        toggleVoice();
      }
    }, 4000);
  } else {
    appendSystemEvent('‚èπ Voice call ended');
    showToast('Voice call ended');
  }
}

function startVoiceCall() {
  showToast('üìû Initiating Vapi Web Call ‚Äî ASSISTANT_ID: "pharma-ai-agent"');
  appendSystemEvent('üìû Web Voice Call initiated via Vapi SDK ‚Äî POST /voice-agent');
  // Vapi SDK: const vapi = new Vapi("PUBLIC_API_KEY"); vapi.start("ASSISTANT_ID");
}

function uploadPrescription() {
  showToast('POST /upload-prescription ‚Äî {"customer_id": currentUser, "medicine": selectedMed}');
  setTimeout(()=>{
    document.getElementById('prescriptionWarn').style.display='none';
    appendSystemEvent('‚úÖ Prescription verified successfully ‚Äî Order can proceed');
    showToast('‚úì Prescription verified successfully');
  }, 1200);
}

function orderMeds() {
  showToast('POST /orders/create ‚Äî Order meds endpoint active');
  appendSystemEvent('üì¶ Order Meds initiated ‚Äî POST /orders/create');
  appendMessage('ai', 'I\'m ready to help you order medications! Please tell me what medicines you need and I\'ll process your order through POST /orders/create with full compliance verification.', 'intent: order_initiation | Status: Ready');
}

// ===== ADMIN DATA =====
function initAdminData() {
  renderOrdersTable(PRODUCTS.map((p,i)=>({...p, orderId:`#ORD${1000+i}`, status:['Completed','Pending','Processing'][i%3]})));
  renderCustomersTable(CUSTOMERS);
  renderStockGrid(stockData);
  renderAdminProducts(PRODUCTS);
  buildBarChart('revenueChart','revenueLabels',MONTHLY_REVENUE,MONTHS);
  buildBarChart('salesBarChart','salesBarLabels',MONTHLY_REVENUE,MONTHS);
  renderOverviewOrders();
  renderTopProducts();
}

function renderOrdersTable(orders) {
  document.getElementById('ordersBody').innerHTML = orders.map(o=>`
    <tr>
      <td><span class="order-detail-tag">${o.orderId}</span></td>
      <td>${o.name}</td>
      <td><span style="font-family:'Space Mono',monospace;font-size:0.78rem">${o.pzn||'‚Äî'}</span></td>
      <td><strong>‚Ç¨${(o.price||0).toFixed(2)}</strong></td>
      <td>${o.size||'‚Äî'}</td>
      <td><span class="status-badge ${o.status==='Completed'?'s-green':o.status==='Pending'?'s-orange':'s-red'}">${o.status}</span></td>
      <td>
        <button onclick="showToast('GET /orders/${o.id} ‚Äî View order details')" style="background:none;border:1px solid var(--border);border-radius:6px;padding:4px 10px;cursor:pointer;font-size:0.78rem">View</button>
      </td>
    </tr>
  `).join('');
}

function renderCustomersTable(customers) {
  document.getElementById('customersBody').innerHTML = customers.map(c=>`
    <tr>
      <td><span class="order-detail-tag">${c.id}</span></td>
      <td>${c.age}</td>
      <td>${c.gender==='M'?'Male':'Female'}</td>
      <td>${c.date}</td>
      <td>${c.product}</td>
      <td>${c.qty}</td>
      <td><strong>‚Ç¨${(c.total||0).toFixed(2)}</strong></td>
      <td><span class="status-badge ${c.rx==='Yes'?'s-orange':'s-green'}">${c.rx==='Yes'?'Required':'Not Required'}</span></td>
    </tr>
  `).join('');
}

function renderAdminProducts(products) {
  const rxMap = {true:'Yes',false:'No'};
  document.getElementById('adminProductsBody').innerHTML = products.map(p=>`
    <tr>
      <td><span style="font-family:'Space Mono',monospace;font-size:0.75rem">${p.id}</span></td>
      <td>${p.name}</td>
      <td><strong>‚Ç¨${p.price.toFixed(2)}</strong></td>
      <td>${p.size}</td>
      <td><span class="status-badge ${p.rx?'s-orange':'s-green'}">${p.rx?'Required':'No'}</span></td>
      <td><span class="status-badge ${p.stock>30?'s-green':p.stock>10?'s-orange':'s-red'}">${p.stock} units</span></td>
      <td>
        <button onclick="showToast('PUT /products/${p.id} ‚Äî Edit product')" style="background:none;border:1px solid var(--border);border-radius:6px;padding:4px 10px;cursor:pointer;font-size:0.78rem">Edit</button>
      </td>
    </tr>
  `).join('');
}

function renderStockGrid(items) {
  document.getElementById('stockGrid').innerHTML = items.map(item=>`
    <div class="stock-card" id="scard-${item.id}">
      <div class="stock-card-top">
        <div>
          <div class="stock-name">${item.name}</div>
          <div class="stock-unit">${item.size} ‚Äî PZN: ${item.pzn||'‚Äî'}</div>
        </div>
        <span class="status-badge ${item.currentStock>30?'s-green':item.currentStock>10?'s-orange':'s-red'}">${item.currentStock>30?'In Stock':item.currentStock>10?'Low':'Critical'}</span>
      </div>
      ${item.currentStock <= 10 ? `<div class="ai-alert" style="margin-bottom:8px;padding:8px 10px;font-size:0.78rem">‚ö° AI Alert: Restock Recommended</div>` : ''}
      <div style="font-size:0.78rem;color:var(--text-muted);margin-bottom:6px">Current Stock ‚Äî PATCH /inventory/${item.id}</div>
      <div class="stock-controls">
        <button class="qty-btn" onclick="adjustStock(${item.id},-1)">‚àí</button>
        <div class="qty-display" id="qty-${item.id}">${item.currentStock}</div>
        <button class="qty-btn" onclick="adjustStock(${item.id},1)">+</button>
        <div class="stock-qty" style="margin-left:auto;font-size:1.3rem;font-weight:800;color:var(--primary)">${item.currentStock}</div>
        <div style="font-size:0.72rem;color:var(--text-muted)">units</div>
      </div>
    </div>
  `).join('');
}

function adjustStock(id, delta) {
  const item = stockData.find(i=>i.id===id);
  if(!item) return;
  item.currentStock = Math.max(0, item.currentStock + delta);
  const qtyEl = document.getElementById('qty-'+id);
  if(qtyEl) qtyEl.textContent = item.currentStock;
  showToast(`PATCH /inventory/${id} ‚Äî Stock updated: ${item.currentStock} units`);
  if(item.currentStock <= 5) showToast(`‚ö†Ô∏è AI Alert: ${item.name} critically low!`, 4000);
}

function renderOverviewOrders() {
  const t = document.getElementById('overviewOrdersTable');
  if(!t) return;
  const sampleOrders = PRODUCTS.slice(0,5).map((p,i)=>({...p,orderId:`#ORD${1000+i}`,status:['Completed','Pending','Processing','Completed','Pending'][i]}));
  t.innerHTML = `<table class="data-table"><thead><tr><th>Order ID</th><th>Medicine</th><th>Price</th><th>Status</th></tr></thead><tbody>${
    sampleOrders.map(o=>`<tr><td>${o.orderId}</td><td>${o.name}</td><td>‚Ç¨${o.price.toFixed(2)}</td><td><span class="status-badge ${o.status==='Completed'?'s-green':o.status==='Pending'?'s-orange':'s-red'}">${o.status}</span></td></tr>`).join('')
  }</tbody></table>`;
}

function renderTopProducts() {
  const t = document.getElementById('topProductsTable');
  if(!t) return;
  const top = [...PRODUCTS].sort(()=>Math.random()-0.5).slice(0,5);
  t.innerHTML = `<table class="data-table"><thead><tr><th>Product</th><th>Price</th><th>Stock</th></tr></thead><tbody>${
    top.map(p=>`<tr><td>${p.name}</td><td>‚Ç¨${p.price.toFixed(2)}</td><td><span class="status-badge ${p.stock>30?'s-green':'s-orange'}">${p.stock} units</span></td></tr>`).join('')
  }</tbody></table>`;
}

// ===== SEARCH FILTERS =====
function filterOrders(q) {
  const orders = PRODUCTS.filter(p=>p.name.toLowerCase().includes(q.toLowerCase())||String(p.pzn).includes(q));
  renderOrdersTable(orders.map((p,i)=>({...p,orderId:`#ORD${1000+i}`,status:['Completed','Pending','Processing'][i%3]})));
}
function filterAdminProducts(q) {
  const filtered = PRODUCTS.filter(p=>p.name.toLowerCase().includes(q.toLowerCase()));
  renderAdminProducts(filtered);
}
function filterCustomers(q) {
  const filtered = CUSTOMERS.filter(c=>c.id.toLowerCase().includes(q.toLowerCase())||c.product.toLowerCase().includes(q.toLowerCase()));
  renderCustomersTable(filtered);
}
function filterStock(q) {
  const filtered = stockData.filter(p=>p.name.toLowerCase().includes(q.toLowerCase()));
  renderStockGrid(filtered);
}

// ===== AI PAGE INIT =====
function initAIPage() {
  const ro = document.getElementById('recentOrdersAI');
  if(ro) ro.innerHTML = CUSTOMERS.slice(0,5).map(c=>`
    <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border)">
      <div>
        <div style="font-weight:600">${c.product}</div>
        <div style="font-size:0.75rem;color:var(--text-muted)">${c.id} ¬∑ ${c.date}</div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:700;color:var(--primary)">‚Ç¨${c.total.toFixed(2)}</div>
        <span class="status-badge ${c.rx==='Yes'?'s-orange':'s-green'}" style="font-size:0.65rem">${c.rx==='Yes'?'Rx':'OTC'}</span>
      </div>
    </div>
  `).join('');
}

// ===== INIT =====
renderProducts(PRODUCTS);
buildBarChart('revenueChart','revenueLabels',MONTHLY_REVENUE,MONTHS);

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(m=>{
  m.addEventListener('click', e=>{ if(e.target===m) m.classList.remove('open'); });
});
</script>
</body>
</html>
